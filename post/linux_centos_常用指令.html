<!doctype html><html lang=zh-tw dir=content/zh-tw>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> linux centos 常用指令 - 補覺鳴詩 </title>
<meta name=keywords content="infra">
<meta name=author content="Owan">
<meta property="og:title" content="linux centos 常用指令">
<meta property="og:site_name" content="補覺鳴詩">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="linux centos 常用指令 - 補覺鳴詩">
<meta name=description content="日常紀錄">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
</div>
<div class=custom-logo-site-title>
<a href=/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>補覺鳴詩</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle>學海無涯</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>首頁
</a>
</li>
<li class=menu-item>
<a href=/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>archive
</a>
</li>
<li class=menu-item>
<a href=/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>關於我
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> 搜尋</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder=搜索關鍵字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">
<a class=post-title-link href=https://lovesharepc.github.io/post/linux_centos_%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4.html itemprop=url>
linux centos 常用指令
</a>
</h1>
<div class=post-meta>
<span class=post-time>
<i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>時間：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2022-02-21">
2022-02-21
</time>
</span>
<span class=post-category>
&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分類：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/categories/linux itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>linux</span>
</a>
&nbsp;
</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/categories/centos itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>centos</span>
</a>
&nbsp;
</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/categories/rocky-linux itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>rocky linux</span>
</a>
&nbsp;
</span>
</span>
<span>
|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字數：</span>
<span class=leancloud-world-count>2089 字</span>
</span>
<span>
|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>閱讀：</span>
<span class=leancloud-view-count>5分鐘</span>
</span>
<span id=/post/linux_centos_%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4.html class=leancloud_visitors data-flag-title="linux centos 常用指令">
|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>閱讀次數：</span>
<span class=leancloud-visitors-count></span>
</span>
</div>
</header>
<div class=post-body itemprop=articleBody>
<p><img src=linux_centos_%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/cat_linux.jpg alt>
紀錄 linux 指令</p>
<h2 id=監控類>監控類</h2>
<h3 id=iostat>iostat</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>dnf install sysstat


[root@localhost local]# iostat -hx 10
Linux 4.18.0-358.el8.x86_64 (localhost.localdomain)     01/17/2022      _x86_64_        (2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.1%    0.0%    0.2%    0.0%    0.0%   99.7%

     r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util Device
    0.04    0.12      1.6k     39.2k     0.00     0.02   0.7%  16.4%    1.56  102.91   0.01    40.7k   324.4k   2.62   0.0% sda
    0.04    0.12      1.4k     39.2k     0.00     0.00   0.0%   0.0%    1.38   60.94   0.01    39.9k   314.8k   2.06   0.0% dm-0
    0.00    0.00      0.0k      0.0k     0.00     0.00   0.0%   0.0%    0.51   49.91   0.00    15.3k     4.0k   1.66   0.0% dm-1

</code></pre></div><h3 id=網路流量>網路流量</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[root@localhost local]# sar -n DEV 1
Linux 4.18.0-358.el8.x86_64 (localhost.localdomain)     01/17/2022      _x86_64_        (2 CPU)

11:16:10 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
11:16:11 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
11:16:11 AM    ens192     18.00      1.00      1.23      0.10      0.00      0.00      0.00      0.00



# 網卡速度
root@pve1:~# ethtool ens192
Settings for ens192:
Supported ports: [ TP ]
Supported link modes:   1000baseT/Full
                        10000baseT/Full
Supported pause frame use: No
Supports auto-negotiation: No
Advertised link modes:  Not reported
Advertised pause frame use: No
Advertised auto-negotiation: No
Speed: 10000Mb/s
Duplex: Full
Port: Twisted Pair
PHYAD: 0
Transceiver: internal
Auto-negotiation: off
MDI-X: Unknown
Supports Wake-on: uag
Wake-on: d
Link detected: yes


root@pve1:~# cat /sys/class/net/ens192/speed
10000
</code></pre></div><h2 id=帳號控制>帳號控制</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>chage  (帳號原則)


usermod  unlock 
</code></pre></div><h2 id=repository>Repository</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># third-party (httpd 、 nginx)
https://codeit.guru/en_US/

#  EPEL (Extra Packages for Enterprise Linux)
yum -y install epel-release

# for centos 8 stream
dnf install epel-next-release
</code></pre></div><h2 id=多工指令>多工指令</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># Move Running Command in Background (pause)
CTRL + Z

# type bg command on terminal
root@tecadmin:~$ bg

# list all jobs running
root@tecadmin:~$ jobs
[1]+  Running                 tar czf log-backup.tar.gz /var/log &amp;

#Move Background Commands to Foreground (Terminal)
root@tecadmin:~$ fg 1

#running in backguard
tar -czf home.tar.gz . &amp;
jobs
</code></pre></div><h2 id=時間>時間</h2>
<p>timezone</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 查詢目前設定
timedatectl

# 查詢可用時區
timedatectl list-timezones | grep Asia

# 設定時區
sudo timedatectl set-timezone Asia/Taipei

</code></pre></div><p>NTP</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>NTP 
yum install chrony  -y

nano /etc/chrony.conf

# as NTP server
allow 0.0.0.0/0

# as NTP client
server &lt;IP address of the NTP server&gt; iburst
maxdistance 16.0

systemctl restart chronyd

firewall-cmd --zone=public --add-port=123/udp --permanent

chronyc makestep

# 確認 NTP 狀態
chronyc tracking

[root@libreNMS ~]#  chronyc sources -v
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^+ 242-184-213-49.tinp.net.&gt;     2   6    17     3   -192us[ -214us] +/- 6802us
^- 103.147.23.5                  2   6    17     2  -4595us[-4617us] +/-   14ms
^- time.cloudflare.com           3   6    17     3   +432us[ +484us] +/-   58ms
^* twtpe2-ntp-002.aaplimg.c&gt;     1   6    17     1  +1188us[+1166us] +/- 3527us
</code></pre></div><h2 id=mount>Mount</h2>
<p>cifs SMB</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>yum install cifs-utils


mount -t cifs -o username=chw,password=&lt;win_share_password&gt;,domain=&lt;win_domain&gt;,vers=3.0 //10.201.100.49/iso /cifs



## /etc/fstab
//192.168.56.1/testdir /mnt/win cifs rw,suid,dir_mode=0777,file_mode=0777,username=帳號,password=密碼 0 0
</code></pre></div><h2 id=du-查空間>du 查空間</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 目錄大小
du */ -sh
sudo du -hs .[a-z]* va* *


#磁碟大小
df -Th
#磁碟 map
lsblk
#磁碟 ID
blkid
</code></pre></div><h2 id=yum>yum</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 找版本
dnf search openjdk
yum  group
[root@ELK27 pa_config]# yum grouplist
Last metadata expiration check: 0:01:55 ago on Sun 08 Aug 2021 11:03:05 AM CST.
Available Environment Groups:
   Server with GUI
   Server
   Workstation
   Virtualization Host
   Custom Operating System
Installed Environment Groups:
   Minimal Install
Available Groups:
   Container Management
   .NET Core Development
   RPM Development Tools
   Development Tools
   Graphical Administration Tools
   Headless Management
   Legacy UNIX Compatibility
   Network Servers
   Scientific Support
   Security Tools
   Smart Card Support
   System Tools



[root@ELK27 pa_config]# yum groups info &#34;Minimal Install&#34;
Last metadata expiration check: 0:03:19 ago on Sun 08 Aug 2021 11:03:05 AM CST.
Environment Group: Minimal Install
 Description: Basic functionality.
 Mandatory Groups:
   Core
 Optional Groups:
   Guest Agents
   Standard


[root@ELK27 pa_config]# yum groups info &#34;Guest Agents&#34;
Last metadata expiration check: 0:05:47 ago on Sun 08 Aug 2021 11:03:05 AM CST.

Group: Guest Agents
 Description: Agents used when running under a hypervisor.
 Mandatory Packages:
   hyperv-daemons
   open-vm-tools
   qemu-guest-agent
</code></pre></div><h2 id=網路設定-nmcli>網路設定 nmcli</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>查看設定
# IP
nmcli

# device
nmcli device show
</code></pre></div><h2 id=其他>其他</h2>
<h3 id=tcpdump>tcpdump</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tcpdump -i ens160 -vv port 514 | grep &lt;ip-address&gt;
</code></pre></div><h3 id=proxy>Proxy</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>PROXY
export http_proxy=http://172.28.11.112:3128/
echo &#34;http_proxy=http://172.28.11.112:3128/&#34; &gt; /etc/environment



Linux 使用全域 Proxy 上網 (with only apt/yum)
2016-12-16 CENTOS, UBUNTU
這一兩天遇到 Server 必須要用 HTTP Proxy 才能上網，順手紀錄一下如何設定
 
使用 export http_proxy / https_proxy 的方式代理
 
全域變數 http_proxy / https_proxy
1    # 暫時生效，重開機proxy就會失效
2    $ export http_proxy=http://proxy.example.com
3     
4    # https用https_proxy
5    $ export https_proxy=https://proxy.example.com
 
設定永久變數
• 僅在目前使用者
永久變數可以寫在登入後會讀取的 ~/.bash_profile , ~/.bashrc
1    $ echo &#34;export http_proxy=http://proxy.example.com&#34; &gt;&gt; ~/.bashrc
2    $ echo &#34;export https_proxy=https://proxy.example.com&#34; &gt;&gt; ~/.bashrc
 
• 針對所有使用者
如果要讓這台主機的所有 http / https 都走 proxy 就設定在 /etc/profile
1    $ echo &#34;export http_proxy=http://proxy.example.com&#34; &gt;&gt; /etc/profile
2    $ echo &#34;export https_proxy=https://proxy.example.com&#34; &gt;&gt; /etc/profile
 
• 僅 apt or yum 使用時才用 proxy


# YUM setting
$ vim /etc/yum.conf
proxy=http://proxy.example.com

# APT setting
$ vim /etc/apt/apt.conf
Acquire::http::Proxy &#34;http://proxy.example.com&#34;;

如果需要驗證的格式為
1    # 變數=http://使用者帳號:密碼@伺服器位址:端口
2    http_proxy=http://user:pass@proxy.example.com:80
 
https 以此類推。

</code></pre></div><p>來自 <a href=https://shazi.info/linux-%E4%BD%BF%E7%94%A8%E5%85%A8%E5%9F%9F-proxy-%E4%B8%8A%E7%B6%B2-with-only-aptyum/>https://shazi.info/linux-%E4%BD%BF%E7%94%A8%E5%85%A8%E5%9F%9F-proxy-%E4%B8%8A%E7%B6%B2-with-only-aptyum/</a></p>
<h3 id=系統版本>系統版本</h3>
<p>看 kernel version</p>
<blockquote>
<p>cat /proc/version
uname -a</p>
</blockquote>
<p>System version</p>
<blockquote>
<p>cat /etc/os-release</p>
</blockquote>
<h3 id=openjdk>openjdk</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cd /usr/lib/

wget  https://download.java.net/java/GA/jdk14.0.1/664493ef4a6946b186ff29eb326336a2/7/GPL/openjdk-14.0.1_linux-x64_bin.tar.gz
tar xvf openjdk-14*.tar.gz &amp;&amp; rm -f openjdk-14*.tar.gz



echo &#34;JAVA_HOME=/usr/lib/jdk-14.0.1/&#34; &gt;&gt; ~/.bashrc
echo &#34;PATH=$PATH:$JAVA_HOME/bin/&#34; &gt;&gt; ~/.bashrc
source ~/.bashrc

reboot


java -version
</code></pre></div><h3 id=dnsperf>dnsperf</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[root@wiznote dnsperf-2.4.0]# sudo dnf copr enable @dnsoarc/dnsperf

wget https://download-ib01.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/c/ck-0.6.0-9.el8.x86_64.rpm



[root@wiznote dnsperf-2.4.0]# sudo dnf install dnsperf

[root@elk-uat-old dnsperf]# dnsperf -h
DNS Performance Testing Tool
Version 2.3.4


Usage: dnsperf [-f family] [-m mode] [-s server_addr] [-p port]
               [-a local_addr] [-x local_port] [-d datafile] [-c clients]
               [-T threads] [-n maxruns] [-l timelimit] [-b buffer_size]
               [-t timeout] [-e] [-E code:value] [-D]
               [-y [alg:]name:secret] [-q num_queries] [-Q max_qps]
               [-S stats_interval] [-u] [-v] [-h]
  -f address family of DNS transport, inet or inet6 (default: any)
  -m set transport mode: udp, tcp or tls (default: udp)
  -s the server to query (default: 127.0.0.1)
  -p the port on which to query the server (default: udp/tcp 53 or tls 853)
  -a the local address from which to send queries
  -x the local port from which to send queries (default: 0)
  -d the input data file (default: stdin)
  -c the number of clients to act as
  -T the number of threads to run
  -n run through input at most N times
  -l run for at most this many seconds
  -b socket send/receive buffer size in kilobytes
  -t the timeout for query completion in seconds (default: 5)
  -e enable EDNS 0
  -E send EDNS option
  -D set the DNSSEC OK bit (implies EDNS)
  -y the TSIG algorithm, name and secret
  -q the maximum number of queries outstanding (default: 100)
  -Q limit the number of queries per second
  -S print qps statistics every N seconds
  -u send dynamic updates instead of queries
  -v verbose: report each query and additional information to stdout
  -h print this help


#####
wget https://www.dns-oarc.net/files/dnsperf/data/queryfile-example-10million-201202.gz
tar xvf queryfile-example-10million-201202.gz
gzip -d  queryfile-example-10million-201202.gz
#####

### 每秒 10000 次查詢 維持 60 秒
dnsperf -s 10.201.102.2 -d queryfile-example-10million-201202 -q 10000 -l 60
</code></pre></div><h3 id=firewall-cmd>firewall-cmd</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>#新增規則
firewall-cmd --permanent --add-service=ftp
firewall-cmd --permanent --add-port=3690/tcp


#列出規則
firewall-cmd --list-all


#套用規則
firewall-cmd --reload
設定 IP
cd /etc/sysconfig/network-scripts
</code></pre></div><h3 id=lvm-修復>LVM 修復</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>
Rescue Mode 中修復
vgscan 
vgchange -a y centos
xfs_repair -L  /dev/centos/root
mkdir /mnt/test &amp;&amp; mount /dev/centos/root /mnt/test
</code></pre></div><h3 id=local-domain-resolve>local domain Resolve</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo vi /etc/nsswitch.conf
hosts:          files dns myhostname


sudo vi /etc/systemd/resolved.conf

[Resolve]
Domains=weicloud.local



relink
sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
</code></pre></div><h3 id=samba>SAMBA</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>yum install samba samba-client samba-common 

# diable selinux
firewall-cmd --permanent --add-service=samba
sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config




cd /etc/samba/
mv smb.conf smb.conf.bak




vi smb.conf
[global]
    workgroup = MYGROUP
    server string = Samba Server Version %v
    security = USER
    map to guest = Bad User
    log file = /var/log/samba/log.%m
    max log size = 50
    idmap config * : backend = tdb
    cups options = raw

# User defined share 
[public]
    path = /home/public
    read only = No
    guest ok = Yes
    browseable = Yes 
    public = Yes


cd /home
mkdir public

We change the owner of the folder and its permissions:
chown nobody:nobody public/
chmod 777 public/

Enabling the needed services and starting them.
systemctl enable smb.service
systemctl enable nmb.service
systemctl restart smb.service
systemctl restart nmb.service

Allowing samba through our firewall.
firewall-cmd --permanent --add-service=samba
firewall-cmd --reload


mount
mount -t cifs -o username=&lt;your_username&gt;,password=&lt;your_password&gt; //server/share /mountpoint
</code></pre></div><h3 id=redhat-59-rsyslog>redhat 5.9 rsyslog</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>install rsyslog
mkdir iso
mount /dev/cdrom /iso

rpm -ivh ./rsyslog-3.22.1-7.el5.x86_64.rpm
service syslog stop
service rsyslog start
chkconfig rsyslog on
chkconfig syslog off
</code></pre></div><h3 id=aliases>Aliases</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nano ~/.bashrc

/etc/bash.bashrc
alias bitfusion4G=&#34;bitfusion run -n 1 -m 4096&#34;
</code></pre></div><h3 id=screen>screen</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>yum install epel-release
yum install screen


screen
screen -r


https://blog.gtwang.org/linux/screen-command-examples-to-manage-linux-terminals/
</code></pre></div><h3 id=coredns--server>coreDNS server</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>https://github.com/coredns/coredns/releases/tag/v1.8.3
wget https://github.com/coredns/coredns/releases/download/v1.8.3/coredns_1.8.3_linux_amd64.tgz
tar zxvf coredns_*

nano Corefile

.:53 {
    forward . 8.8.8.8 9.9.9.9
    log
    errors
}
# Load hosts file inlined in Corefile.
# domain:example.com 、weicloud.local
1.hosts adcmuh.org.tw in-addr.arpa ip6.arpa {
    hosts {
        10.17.1.100 sfo-m01-vc01.adcmuh.org.tw
        fallthrough in-addr.arpa ip6.arpa
    }
}
</code></pre></div><h3 id=mtu-test>MTU test</h3>
<blockquote>
<p>ping -M do -s 8972 <host>
1452 正常</p>
</blockquote>
<h3 id=webmin>webmin</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nano /etc/yum.repos.d/webmin.repo
[Webmin]
name=Webmin Distribution Neutral
#baseurl=https://download.webmin.com/download/yum
mirrorlist=https://download.webmin.com/download/yum/mirrorlist
enabled=1
安裝
wget https://download.webmin.com/jcameron-key.asc
rpm --import jcameron-key.asc
yum -y install webmin 
</code></pre></div><h3 id=iscsi>iSCSI</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>target = server
initiator = client


server 
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/online-storage-management#osm-target-setup
yum install -y targetcli
systemctl start target.service
systemctl enable target.service

[root@iscsi ~]# targetcli
targetcli shell version 2.1.53
Copyright 2011-2013 by Datera, Inc and others.
For help on commands, type &#39;help&#39;.

/&gt; ls
o- / ......................................................................................................................... [...]
  o- backstores .............................................................................................................. [...]
  | o- block .................................................................................................. [Storage Objects: 0]
  | o- fileio ................................................................................................. [Storage Objects: 0]
  | o- pscsi .................................................................................................. [Storage Objects: 0]
  | o- ramdisk ................................................................................................ [Storage Objects: 0]
  o- iscsi ............................................................................................................ [Targets: 0]
  o- loopback ......................................................................................................... [Targets: 0]
/&gt; backstores/fileio create test /tmp/test.img 10G
Created fileio test with size 10737418240
/&gt; iscsi/ create
Created target iqn.2003-01.org.linux-iscsi.iscsi.x8664:sn.6f68b6498ffb.
Created TPG 1.
Global pref auto_add_default_portal=true
Created default portal listening on all IPs (0.0.0.0), port 3260.
/&gt; cd iscsi/iqn.2003-01.org.linux-iscsi.iscsi.x8664:sn.6f68b6498ffb/tpg1/
/iscsi/iqn.20...b6498ffb/tpg1&gt; luns/ create /backstores/fileio/test
Created LUN 0.
/iscsi/iqn.20...b6498ffb/tpg1&gt; set attribute generate_node_acls=1
Parameter generate_node_acls is now &#39;1&#39;.
/iscsi/iqn.20...b6498ffb/tpg1&gt; set attribute demo_mode_write_protect=0
Parameter demo_mode_write_protect is now &#39;0&#39;.
/iscsi/iqn.20...b6498ffb/tpg1&gt; exit
Global pref auto_save_on_exit=true
Configuration saved to /etc/target/saveconfig.json
</code></pre></div><h3 id=rsync>Rsync</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># 無認證
yum install rsync

# config
 [ftp]
        path = /home/ftp
        comment = ftp export area
        read only = no


mkdir /home/ftp
chown /home/ftp
sysstemctl start rsyncd
sysstemctl enable rsyncd


# 語法
rsync -arvzh /home/joseph/public/www  SERVER_IP_ADDRESS::ftp 




認證版
 [ftp]
        uid = nobody
        gid = nobody
        path = /home/ftp
        comment = ftp export area
        read only = no
        auth users = ftpuser
        secrets file = /home/ftpuser/rsync/rsync.secret


mkdir -p /home/ftpuser/rsync
nano /home/ftpuser/rsync/rsync.secret
ftpuser:PASSWORD

###################################
# client
# 以 root 建立密碼檔 vi /home/rsyncpasswd
!QAZ2wsx#EDC

# 修改權限 chmod 600 /home/rsyncpasswd
# 測試傳輸
rsync -arvzh DB log  ftpuser@10.201.102.24::ftp  --password-file=/home/rsyncpasswd


# 定時執行 vi /var/spool/cron/crontabs/root
# 新增
* 1 * * * rsync -arvzh DB log  ftpuser@10.201.102.24::ftp  --password-file=/home/rsyncpasswd
</code></pre></div><h3 id=tar-自動建立日期>tar 自動建立日期</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>#backup VM
#ap1
tar zcfP \
/SystemBackup/image/IBM_SAS/vm-106-disk-0_$(date +%F).tar.gz \
/IBM_SAS/images/106/vm-106-disk-0.qcow2 --warning=none
</code></pre></div><h3 id=sudo>sudo</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># add sudo 權限
adduser username
passwd username
usermod -aG wheel username

## or 
# 查詢所屬 group
# groups &lt;user&gt;
WEICLOUD\chw@testlinux1 ~]$ groups  WEICLOUD\\chw
WEICLOUD\chw : WEICLOUD\domain^users WEICLOUD\domain^admins WEICLOUD\aa_users WEICLOUD\sudousers WEICLOUD\denied^rodc^password^replication^group

# edit /etc/sudoers
# 新增
%WEICLOUD\\domain^users  ALL=(ALL)       ALL
</code></pre></div><h3 id=smartctl-查看硬碟資訊>smartctl 查看硬碟資訊</h3>
<blockquote>
<p>smartctl -i /dev/sdb</p>
</blockquote>
<h3 id=detect-the-desktop-environment>Detect the Desktop Environment</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>How to Detect the Desktop Environment in Linux Command Line
ps -e | grep -E -i &#34;xfce|kde|gnome&#34;

# or
# 在 x-windows 環境下才有用
echo $XDG_CURRENT_DESKTOP
</code></pre></div>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/linux rel=tag title=linux>#linux#</a>
<a href=/tags/centos rel=tag title=centos>#centos#</a>
<a href=/tags/rocky-linux rel=tag title="rocky linux">#rocky linux#</a>
</div>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//bu-jue-ming-shi.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<ul class="sidebar-nav motion-element">
<li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>
文章目錄
</li>
<li class=sidebar-nav-overview data-target=site-overview>
網站導覽
</li>
</ul>
<section class="site-overview sidebar-panel">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=Owan>
<p class=site-author-name itemprop=name>Owan</p>
<p class="site-description motion-element" itemprop=description>
愛貓如癡
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/post/>
<span class=site-state-item-count>123</span>
<span class=site-state-item-name>日誌</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>23</span>
<span class=site-state-item-name>分類</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>31</span>
<span class=site-state-item-name>標籤</span>
</a>
</div>
</nav>
<div class="links-of-author motion-element">
<span class=links-of-author-item>
<a href=https://github.com/lovesharepc/ target=_blank title=GitHub>
<i class="fa fa-fw fa-github"></i>
GitHub
</a>
</span>
</div>
</section>
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
<div class=post-toc>
<div class=post-toc-content><nav id=TableOfContents>
<ul>
<li><a href=#監控類>監控類</a>
<ul>
<li><a href=#iostat>iostat</a></li>
<li><a href=#網路流量>網路流量</a></li>
</ul>
</li>
<li><a href=#帳號控制>帳號控制</a></li>
<li><a href=#repository>Repository</a></li>
<li><a href=#多工指令>多工指令</a></li>
<li><a href=#時間>時間</a></li>
<li><a href=#mount>Mount</a></li>
<li><a href=#du-查空間>du 查空間</a></li>
<li><a href=#yum>yum</a></li>
<li><a href=#網路設定-nmcli>網路設定 nmcli</a></li>
<li><a href=#其他>其他</a>
<ul>
<li><a href=#tcpdump>tcpdump</a></li>
<li><a href=#proxy>Proxy</a></li>
<li><a href=#系統版本>系統版本</a></li>
<li><a href=#openjdk>openjdk</a></li>
<li><a href=#dnsperf>dnsperf</a></li>
<li><a href=#firewall-cmd>firewall-cmd</a></li>
<li><a href=#lvm-修復>LVM 修復</a></li>
<li><a href=#local-domain-resolve>local domain Resolve</a></li>
<li><a href=#samba>SAMBA</a></li>
<li><a href=#redhat-59-rsyslog>redhat 5.9 rsyslog</a></li>
<li><a href=#aliases>Aliases</a></li>
<li><a href=#screen>screen</a></li>
<li><a href=#coredns--server>coreDNS server</a></li>
<li><a href=#mtu-test>MTU test</a></li>
<li><a href=#webmin>webmin</a></li>
<li><a href=#iscsi>iSCSI</a></li>
<li><a href=#rsync>Rsync</a></li>
<li><a href=#tar-自動建立日期>tar 自動建立日期</a></li>
<li><a href=#sudo>sudo</a></li>
<li><a href=#smartctl-查看硬碟資訊>smartctl 查看硬碟資訊</a></li>
<li><a href=#detect-the-desktop-environment>Detect the Desktop Environment</a></li>
</ul>
</li>
</ul>
</nav></div>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>補覺鳴詩</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.92.2</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>