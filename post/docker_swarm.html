<!doctype html><html lang=zh-tw dir=content/zh-tw>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> docker swarm - 補覺鳴詩 </title>
<meta name=keywords content="infra">
<meta name=author content="Owan">
<meta property="og:title" content="docker swarm">
<meta property="og:site_name" content="補覺鳴詩">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="docker swarm - 補覺鳴詩">
<meta name=description content="docker">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
</div>
<div class=custom-logo-site-title>
<a href=/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>補覺鳴詩</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle>學海無涯</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>首頁
</a>
</li>
<li class=menu-item>
<a href=/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>archive
</a>
</li>
<li class=menu-item>
<a href=/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>關於我
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> 搜尋</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder=搜索關鍵字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">
<a class=post-title-link href=https://lovesharepc.github.io/post/docker_swarm.html itemprop=url>
docker swarm
</a>
</h1>
<div class=post-meta>
<span class=post-time>
<i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>時間：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2022-03-04">
2022-03-04
</time>
</span>
<span class=post-category>
&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分類：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/categories/docker itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>docker</span>
</a>
&nbsp;
</span>
</span>
<span>
|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字數：</span>
<span class=leancloud-world-count>1172 字</span>
</span>
<span>
|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>閱讀：</span>
<span class=leancloud-view-count>3分鐘</span>
</span>
<span id=/post/docker_swarm.html class=leancloud_visitors data-flag-title="docker swarm">
|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>閱讀次數：</span>
<span class=leancloud-visitors-count></span>
</span>
</div>
</header>
<div class=post-body itemprop=articleBody>
<p>docker swarm
就是把多個 docker 主機變成一個叢集使用</p>
<p><img src=assets/container_cats.jpg alt></p>
<h2 id=優點>優點</h2>
<ul>
<li>
<p><strong>Cluster management integrated with Docker Engine:</strong> Use the Docker Engine CLI to create a swarm of Docker Engines where you can deploy application services. You don’t need additional orchestration software to create or manage a swarm.
不須其他工具就能完成 cluster 工作</p>
</li>
<li>
<p><strong>Decentralized design:</strong> Instead of handling differentiation between node roles at deployment time, the Docker Engine handles any specialization at runtime. You can deploy both kinds of nodes, managers and workers, using the Docker Engine. This means you can build an entire swarm from a single disk image.
去中心化設計，將部屬節點以 role 區分，而不以 image 區分
簡化部屬難度</p>
</li>
<li>
<p><strong>Declarative service model:</strong> Docker Engine uses a declarative approach to let you define the desired state of the various services in your application stack. For example, you might describe an application comprised of a web front end service with message queueing services and a database backend.
使用陳述式部屬 service (docker-compose)</p>
</li>
<li>
<p><strong>Scaling:</strong> For each service, you can declare the number of tasks you want to run. When you scale up or down, the swarm manager automatically adapts by adding or removing tasks to maintain the desired state.
可自由調整節點數量</p>
</li>
<li>
<p><strong>Desired state reconciliation:</strong> The swarm manager node constantly monitors the cluster state and reconciles any differences between the actual state and your expressed desired state. For example, if you set up a service to run 10 replicas of a container, and a worker machine hosting two of those replicas crashes, the manager creates two new replicas to replace the replicas that crashed. The swarm manager assigns the new replicas to workers that are running and available.
自動恢復期望狀態
當有 containner 故障時，自動修復</p>
</li>
<li>
<p><strong>Multi-host networking:</strong> You can specify an overlay network for your services. The swarm manager automatically assigns addresses to the containers on the overlay network when it initializes or updates the application.
可設定 overlay network 跨主機網路</p>
</li>
<li>
<p><strong>Service discovery:</strong> Swarm manager nodes assign each service in the swarm a unique DNS name and load balances running containers. You can query every container running in the swarm through a DNS server embedded in the swarm.
內建 DNS 功能</p>
</li>
<li>
<p><strong>Load balancing:</strong> You can expose the ports for services to an external load balancer. Internally, the swarm lets you specify how to distribute service containers between nodes.
內建 load balancing 功能</p>
</li>
<li>
<p><strong>Secure by default:</strong> Each node in the swarm enforces TLS mutual authentication and encryption to secure communications between itself and all other nodes. You have the option to use self-signed root certificates or certificates from a custom root CA.
預設加密</p>
</li>
<li>
<p><strong>Rolling updates:</strong> At rollout time you can apply service updates to nodes incrementally. The swarm manager lets you control the delay between service deployment to different sets of nodes. If anything goes wrong, you can roll back to a previous version of the service.
自動滾動更新功能
不須人工介入</p>
</li>
</ul>
<h2 id=節點-新增>節點 新增</h2>
<p>manager node 1</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker swarm init --advertise-addr 192.168.15.141</span>
Swarm initialized<span>:</span> current node (r8erv03rgzp5zxqm1xcshqdyl) is now a manager.

To add a worker to this swarm, run the following command<span>:</span>

    docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-5nhsrdbzq4dvlpp1t23cjx93y 192.168.15.141<span>:</span>2377

To add a manager to this swarm, run <span style=color:#b44>&#39;docker swarm join-token manager&#39;</span> and follow the instructions.

<span style=color:#080;font-style:italic># 執行 docker swarm join-token manager 產生 token 允許增加 manager node</span>
[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker swarm join-token manager</span>
To add a manager to this swarm, run the following command<span>:</span>

    docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-4wz4235g7e1a1pdgtcvdh406z 192.168.15.141<span>:</span>2377

</code></pre></div><p>manager node 2</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@node2</span> ~]<span style=color:#080;font-style:italic># docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-4wz4235g7e1a1pdgtcvdh406z 192.168.15.141:2377</span>
This node joined a swarm as a manager.

[root<span style=color:#b8860b>@node2</span> ~]<span style=color:#080;font-style:italic># docker node ls</span>
ID                            HOSTNAME      STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION
r8erv03rgzp5zxqm1xcshqdyl     node1.local   Ready     Active         Leader           20.10.12
m158ryu3mk3zyvpyl777fud0j *   node2.local   Ready     Active         Reachable        20.10.12



</code></pre></div><p>worker node 1</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@mgmt</span> ~]<span style=color:#080;font-style:italic># ssh root@192.168.15.144</span>
Last login<span>:</span> Mon Mar  7 10<span>:</span>36<span>:</span>36 2022 from 192.168.15.100
[root<span style=color:#b8860b>@node4</span> ~]<span style=color:#080;font-style:italic># docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-5nhsrdbzq4dvlpp1t23cjx93y 192.168.15.141:2377</span>
This node joined a swarm as a worker.


</code></pre></div><p>再次顯示 join token</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>docker swarm <span style=color:#a2f>join-token</span> worker

docker swarm <span style=color:#a2f>join-token</span> manager

</code></pre></div><h3 id=service-control>service control</h3>
<p><strong>depoly</strong></p>
<ul>
<li>The <code>docker service create</code> command creates the service.</li>
<li>The <code>--name</code> flag names the service <code>helloworld</code>.</li>
<li>The <code>--replicas</code> flag specifies the desired state of 1 running instance.</li>
<li>The arguments <code>alpine ping docker.com</code> define the service as an Alpine Linux container that executes the command <code>ping docker.com</code>.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service create --replicas 1 --name helloworld alpine ping docker.com</span>
jmz6nfsabxz0nxa6qmxya6su6
overall progress<span>:</span> 1 out of 1 tasks
1/1<span>:</span> running   [==================================================&gt;]
verify<span>:</span> Service converged

<span style=color:#080;font-style:italic># Run docker service ls</span>
[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service ls</span>
ID             NAME         MODE         REPLICAS   IMAGE           PORTS
jmz6nfsabxz0   helloworld   replicated   1/1        alpine<span>:</span>latest

</code></pre></div><p>** Inspect**
(檢查) a service on the swarm</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service inspect --pretty helloworld</span>

ID<span>:</span>             jmz6nfsabxz0nxa6qmxya6su6
Name<span>:</span>           helloworld
Service Mode<span>:</span>   Replicated
 Replicas<span>:</span>      1
Placement<span>:</span>
UpdateConfig<span>:</span>
 Parallelism<span>:</span>   1
 On failure<span>:</span>    pause
 Monitoring Period<span>:</span> 5s
 Max failure ratio<span>:</span> 0
 Update order<span>:</span>      <span style=color:#a2f>stop-first</span>
RollbackConfig<span>:</span>
 Parallelism<span>:</span>   1
 On failure<span>:</span>    pause
 Monitoring Period<span>:</span> 5s
 Max failure ratio<span>:</span> 0
 Rollback order<span>:</span>    <span style=color:#a2f>stop-first</span>
ContainerSpec<span>:</span>
 Image<span>:</span>         alpine<span>:</span>latest<span style=color:#b8860b>@sha256</span><span>:</span>21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300
 Args<span>:</span>          ping docker.com
 Init<span>:</span>          false
Resources<span>:</span>
Endpoint Mode<span>:</span>  vip

</code></pre></div><p><strong>Scale</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>docker service scale helloworld=5

</code></pre></div><p><strong>remove</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>docker service <span style=color:#a2f>rm </span>helloworld

</code></pre></div><p><strong>rolling updates</strong></p>
<p>建立</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#080;font-style:italic># 建立 </span>
docker service create \
  --replicas 3 \
  --name redis \
  --update-delay 10s \
  redis<span>:</span>3.0.6
</code></pre></div><p>&ndash;update-delay :更新間隔
&ndash;update-parallelism :同步更新數量 預設1
更新失敗時 預設會暫停</p>
<p><strong>node 維護</strong>
有三種狀態
&ldquo;active&rdquo;|&ldquo;pause&rdquo;|&ldquo;drain&rdquo;</p>
<p>drain : 漂走 service，新的 service 也不會在此節點運作，standalone container 不受影響</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker node update --availability drain node4.local</span>
node4.local

[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker node inspect --pretty node4.local</span>
ID<span>:</span>                     mbmizzrjmmr2c8ixiz13admto
Hostname<span>:</span>               node4.local
Joined at<span>:</span>              2022-03-07 03<span>:</span>21<span>:</span>41.110232554 +0000 utc
Status<span>:</span>
 State<span>:</span>                 Ready
 Availability<span>:</span>          Drain
 Address<span>:</span>               192.168.15.144
Platform<span>:</span>
 Operating System<span>:</span>      linux
 Architecture<span>:</span>          x86_64
Resources<span>:</span>
 CPUs<span>:</span>                  2
 Memory<span>:</span>                1.774GiB
Plugins<span>:</span>
 Log<span>:</span>           awslogs, fluentd, gcplogs, gelf, journald, <span style=color:#a2f>json-file</span>, local, logentries, splunk, syslog
 Network<span>:</span>               bridge, host, ipvlan, macvlan, null, overlay
 Volume<span>:</span>                local
Engine Version<span>:</span>         20.10.12


<span style=color:#080;font-style:italic># 復原</span>
docker node update --availability active

</code></pre></div><p><strong>Publish a port</strong></p>
<p>每個 node 的 8080 port 都會提供改此 service 使用
並且內部有 mesh</p>
<p><img src=assets/ingress-routing-mesh.png alt=ingress-routing-mesh.png></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>docker service create \
  --name <span style=color:#a2f>my-web</span> \
  --publish published=8080,target=80 \
  --replicas 10 \
  nginx

<span style=color:#080;font-style:italic>#或是</span>

docker service create \
  --name <span style=color:#a2f>my-web</span> \
  -p 8080<span>:</span>80 \
  --replicas 10 \
  nginx

</code></pre></div><p>UDP 與 TCP</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>docker service create --name <span style=color:#a2f>dns-cache</span> \
 --publish published=53,target=53 \
 --publish published=53,target=53,protocol=udp \
 <span style=color:#a2f>dns-cache</span>
</code></pre></div><h2 id=節點-移除>節點 移除</h2>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/docker rel=tag title=docker>#docker#</a>
</div>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//bu-jue-ming-shi.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<ul class="sidebar-nav motion-element">
<li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>
文章目錄
</li>
<li class=sidebar-nav-overview data-target=site-overview>
網站導覽
</li>
</ul>
<section class="site-overview sidebar-panel">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=Owan>
<p class=site-author-name itemprop=name>Owan</p>
<p class="site-description motion-element" itemprop=description>
愛貓如癡
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/post/>
<span class=site-state-item-count>129</span>
<span class=site-state-item-name>日誌</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>26</span>
<span class=site-state-item-name>分類</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>34</span>
<span class=site-state-item-name>標籤</span>
</a>
</div>
</nav>
<div class="links-of-author motion-element">
<span class=links-of-author-item>
<a href=https://github.com/lovesharepc/ target=_blank title=GitHub>
<i class="fa fa-fw fa-github"></i>
GitHub
</a>
</span>
</div>
</section>
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
<div class=post-toc>
<div class=post-toc-content><nav id=TableOfContents>
<ul>
<li><a href=#優點>優點</a></li>
<li><a href=#節點-新增>節點 新增</a>
<ul>
<li><a href=#service-control>service control</a></li>
</ul>
</li>
<li><a href=#節點-移除>節點 移除</a></li>
</ul>
</nav></div>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>補覺鳴詩</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.92.2</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>