<!doctype html><html lang=zh-tw dir=content/zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>docker swarm - 補覺鳴詩</title><meta name=keywords content="infra"><meta name=author content="Owan"><meta property="og:title" content="docker swarm"><meta property="og:site_name" content="補覺鳴詩"><meta property="og:image" content="/img/author.jpg"><meta name=title content="docker swarm - 補覺鳴詩"><meta name=description content="docker"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>補覺鳴詩</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>學海無涯</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首頁</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>archive</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>關於我</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜尋</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索關鍵字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://lovesharepc.github.io/post/docker_swarm.html itemprop=url>docker swarm</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>時間：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2022-03-04">2022-03-04</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分類：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/docker itemprop=url rel=index style=text-decoration:underline><span itemprop=name>docker</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字數：</span>
<span class=leancloud-world-count>1370 字</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>閱讀：</span>
<span class=leancloud-view-count>3分鐘</span></span>
<span id=/post/docker_swarm.html class=leancloud_visitors data-flag-title="docker swarm">|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>閱讀次數：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>docker swarm
就是把多個 docker 主機變成一個叢集使用</p><p><img src=assets/container_cats.jpg alt></p><h2 id=優點>優點</h2><ul><li><p><strong>Cluster management integrated with Docker Engine:</strong> Use the Docker Engine CLI to create a swarm of Docker Engines where you can deploy application services. You don’t need additional orchestration software to create or manage a swarm.
不須其他工具就能完成 cluster 工作</p></li><li><p><strong>Decentralized design:</strong> Instead of handling differentiation between node roles at deployment time, the Docker Engine handles any specialization at runtime. You can deploy both kinds of nodes, managers and workers, using the Docker Engine. This means you can build an entire swarm from a single disk image.
去中心化設計，將部屬節點以 role 區分，而不以 image 區分
簡化部屬難度</p></li><li><p><strong>Declarative service model:</strong> Docker Engine uses a declarative approach to let you define the desired state of the various services in your application stack. For example, you might describe an application comprised of a web front end service with message queueing services and a database backend.
使用陳述式部屬 service (docker-compose)</p></li><li><p><strong>Scaling:</strong> For each service, you can declare the number of tasks you want to run. When you scale up or down, the swarm manager automatically adapts by adding or removing tasks to maintain the desired state.
可自由調整節點數量</p></li><li><p><strong>Desired state reconciliation:</strong> The swarm manager node constantly monitors the cluster state and reconciles any differences between the actual state and your expressed desired state. For example, if you set up a service to run 10 replicas of a container, and a worker machine hosting two of those replicas crashes, the manager creates two new replicas to replace the replicas that crashed. The swarm manager assigns the new replicas to workers that are running and available.
自動恢復期望狀態
當有 containner 故障時，自動修復</p></li><li><p><strong>Multi-host networking:</strong> You can specify an overlay network for your services. The swarm manager automatically assigns addresses to the containers on the overlay network when it initializes or updates the application.
可設定 overlay network 跨主機網路</p></li><li><p><strong>Service discovery:</strong> Swarm manager nodes assign each service in the swarm a unique DNS name and load balances running containers. You can query every container running in the swarm through a DNS server embedded in the swarm.
內建 DNS 功能</p></li><li><p><strong>Load balancing:</strong> You can expose the ports for services to an external load balancer. Internally, the swarm lets you specify how to distribute service containers between nodes.
內建 load balancing 功能</p></li><li><p><strong>Secure by default:</strong> Each node in the swarm enforces TLS mutual authentication and encryption to secure communications between itself and all other nodes. You have the option to use self-signed root certificates or certificates from a custom root CA.
預設加密</p></li><li><p><strong>Rolling updates:</strong> At rollout time you can apply service updates to nodes incrementally. The swarm manager lets you control the delay between service deployment to different sets of nodes. If anything goes wrong, you can roll back to a previous version of the service.
自動滾動更新功能
不須人工介入</p></li></ul><h2 id=節點>節點</h2><h3 id=新增>新增</h3><p>manager node 1</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker swarm init --advertise-addr 192.168.15.141</span>
</span></span><span style=display:flex><span>Swarm initialized<span>:</span> current node (r8erv03rgzp5zxqm1xcshqdyl) is now a manager.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To add a worker to this swarm, run the following command<span>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-5nhsrdbzq4dvlpp1t23cjx93y 192.168.15.141<span>:</span>2377
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To add a manager to this swarm, run <span style=color:#b44>&#39;docker swarm join-token manager&#39;</span> and follow the instructions.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 執行 docker swarm join-token manager 產生 token 允許增加 manager node</span>
</span></span><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker swarm join-token manager</span>
</span></span><span style=display:flex><span>To add a manager to this swarm, run the following command<span>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-4wz4235g7e1a1pdgtcvdh406z 192.168.15.141<span>:</span>2377
</span></span></code></pre></div><p>manager node 2</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@node2</span> ~]<span style=color:#080;font-style:italic># docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-4wz4235g7e1a1pdgtcvdh406z 192.168.15.141:2377</span>
</span></span><span style=display:flex><span>This node joined a swarm as a manager.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root<span style=color:#b8860b>@node2</span> ~]<span style=color:#080;font-style:italic># docker node ls</span>
</span></span><span style=display:flex><span>ID                            HOSTNAME      STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION
</span></span><span style=display:flex><span>r8erv03rgzp5zxqm1xcshqdyl     node1.local   Ready     Active         Leader           20.10.12
</span></span><span style=display:flex><span>m158ryu3mk3zyvpyl777fud0j *   node2.local   Ready     Active         Reachable        20.10.12
</span></span></code></pre></div><p>worker node 1</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@mgmt</span> ~]<span style=color:#080;font-style:italic># ssh root@192.168.15.144</span>
</span></span><span style=display:flex><span>Last login<span>:</span> Mon Mar  7 10<span>:</span>36<span>:</span>36 2022 from 192.168.15.100
</span></span><span style=display:flex><span>[root<span style=color:#b8860b>@node4</span> ~]<span style=color:#080;font-style:italic># docker swarm join --token SWMTKN-1-2gabg98ff8uiju4una8jmvg3q8zymne6onkpydl0jbbzot0o09-5nhsrdbzq4dvlpp1t23cjx93y 192.168.15.141:2377</span>
</span></span><span style=display:flex><span>This node joined a swarm as a worker.
</span></span></code></pre></div><p>再次顯示 join token</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker swarm <span style=color:#a2f>join-token</span> worker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker swarm <span style=color:#a2f>join-token</span> manager
</span></span></code></pre></div><h3 id=節點-維護>節點 維護</h3><p>有三種狀態
&ldquo;active&rdquo;|&ldquo;pause&rdquo;|&ldquo;drain&rdquo;</p><p>drain : 漂走 service，新的 service 也不會在此節點運作，standalone container 不受影響
另外也可以將 manager node 改成 drain 狀態
讓其 always 只負責 manager 功能</p><p>pause: service 持續運作</p><h3 id=節點-移除>節點 移除</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker swarm leave --force
</span></span></code></pre></div><h2 id=docker-swarm-shared-storage>docker swarm shared storage</h2><p>containner 要儲存資料時，需要一個持續性空間
而多台 docker node 為了要讓每個節點都能夠存取同份資料
可以使用 shared storage</p><p>可參考使用
ocfs2
GFS2
gluster</p><p>以效能來說 ocfs2 最強</p><h2 id=service-control>service control</h2><p><a href=https://docs.docker.com/engine/swarm/ingress/>https://docs.docker.com/engine/swarm/ingress/</a>
<strong>depoly</strong></p><ul><li>The <code>docker service create</code> command creates the service.</li><li>The <code>--name</code> flag names the service <code>helloworld</code>.</li><li>The <code>--replicas</code> flag specifies the desired state of 1 running instance.</li><li>The arguments <code>alpine ping docker.com</code> define the service as an Alpine Linux container that executes the command <code>ping docker.com</code>.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service create --replicas 1 --name helloworld alpine ping docker.com</span>
</span></span><span style=display:flex><span>jmz6nfsabxz0nxa6qmxya6su6
</span></span><span style=display:flex><span>overall progress<span>:</span> 1 out of 1 tasks
</span></span><span style=display:flex><span>1/1<span>:</span> running   [==================================================&gt;]
</span></span><span style=display:flex><span>verify<span>:</span> Service converged
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Run docker service ls</span>
</span></span><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service ls</span>
</span></span><span style=display:flex><span>ID             NAME         MODE         REPLICAS   IMAGE           PORTS
</span></span><span style=display:flex><span>jmz6nfsabxz0   helloworld   replicated   1/1        alpine<span>:</span>latest
</span></span></code></pre></div><p>** Inspect**
(檢查) a service on the swarm</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker service inspect --pretty helloworld</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ID<span>:</span>             jmz6nfsabxz0nxa6qmxya6su6
</span></span><span style=display:flex><span>Name<span>:</span>           helloworld
</span></span><span style=display:flex><span>Service Mode<span>:</span>   Replicated
</span></span><span style=display:flex><span> Replicas<span>:</span>      1
</span></span><span style=display:flex><span>Placement<span>:</span>
</span></span><span style=display:flex><span>UpdateConfig<span>:</span>
</span></span><span style=display:flex><span> Parallelism<span>:</span>   1
</span></span><span style=display:flex><span> On failure<span>:</span>    pause
</span></span><span style=display:flex><span> Monitoring Period<span>:</span> 5s
</span></span><span style=display:flex><span> Max failure ratio<span>:</span> 0
</span></span><span style=display:flex><span> Update order<span>:</span>      <span style=color:#a2f>stop-first</span>
</span></span><span style=display:flex><span>RollbackConfig<span>:</span>
</span></span><span style=display:flex><span> Parallelism<span>:</span>   1
</span></span><span style=display:flex><span> On failure<span>:</span>    pause
</span></span><span style=display:flex><span> Monitoring Period<span>:</span> 5s
</span></span><span style=display:flex><span> Max failure ratio<span>:</span> 0
</span></span><span style=display:flex><span> Rollback order<span>:</span>    <span style=color:#a2f>stop-first</span>
</span></span><span style=display:flex><span>ContainerSpec<span>:</span>
</span></span><span style=display:flex><span> Image<span>:</span>         alpine<span>:</span>latest<span style=color:#b8860b>@sha256</span><span>:</span>21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300
</span></span><span style=display:flex><span> Args<span>:</span>          ping docker.com
</span></span><span style=display:flex><span> Init<span>:</span>          false
</span></span><span style=display:flex><span>Resources<span>:</span>
</span></span><span style=display:flex><span>Endpoint Mode<span>:</span>  vip
</span></span></code></pre></div><p><strong>Scale</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker service scale helloworld=5
</span></span></code></pre></div><p><strong>remove</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker service <span style=color:#a2f>rm </span>helloworld
</span></span></code></pre></div><p><strong>rolling updates</strong></p><p>建立</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#080;font-style:italic># 建立 </span>
</span></span><span style=display:flex><span>docker service create \
</span></span><span style=display:flex><span>  --replicas 3 \
</span></span><span style=display:flex><span>  --name redis \
</span></span><span style=display:flex><span>  --update-delay 10s \
</span></span><span style=display:flex><span>  redis<span>:</span>3.0.6
</span></span></code></pre></div><p>&ndash;update-delay :更新間隔
&ndash;update-parallelism :同步更新數量 預設1
更新失敗時 預設會暫停</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker node update --availability drain node4.local</span>
</span></span><span style=display:flex><span>node4.local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root<span style=color:#b8860b>@node1</span> ~]<span style=color:#080;font-style:italic># docker node inspect --pretty node4.local</span>
</span></span><span style=display:flex><span>ID<span>:</span>                     mbmizzrjmmr2c8ixiz13admto
</span></span><span style=display:flex><span>Hostname<span>:</span>               node4.local
</span></span><span style=display:flex><span>Joined at<span>:</span>              2022-03-07 03<span>:</span>21<span>:</span>41.110232554 +0000 utc
</span></span><span style=display:flex><span>Status<span>:</span>
</span></span><span style=display:flex><span> State<span>:</span>                 Ready
</span></span><span style=display:flex><span> Availability<span>:</span>          Drain
</span></span><span style=display:flex><span> Address<span>:</span>               192.168.15.144
</span></span><span style=display:flex><span>Platform<span>:</span>
</span></span><span style=display:flex><span> Operating System<span>:</span>      linux
</span></span><span style=display:flex><span> Architecture<span>:</span>          x86_64
</span></span><span style=display:flex><span>Resources<span>:</span>
</span></span><span style=display:flex><span> CPUs<span>:</span>                  2
</span></span><span style=display:flex><span> Memory<span>:</span>                1.774GiB
</span></span><span style=display:flex><span>Plugins<span>:</span>
</span></span><span style=display:flex><span> Log<span>:</span>           awslogs, fluentd, gcplogs, gelf, journald, <span style=color:#a2f>json-file</span>, local, logentries, splunk, syslog
</span></span><span style=display:flex><span> Network<span>:</span>               bridge, host, ipvlan, macvlan, null, overlay
</span></span><span style=display:flex><span> Volume<span>:</span>                local
</span></span><span style=display:flex><span>Engine Version<span>:</span>         20.10.12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 復原</span>
</span></span><span style=display:flex><span>docker node update --availability active
</span></span></code></pre></div><p><strong>Publish a port</strong></p><p>每個 node 的 8080 port 都會提供改此 service 使用
並且內部有 mesh</p><p><img src=assets/ingress-routing-mesh.png alt=ingress-routing-mesh.png></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker service create \
</span></span><span style=display:flex><span>  --name <span style=color:#a2f>my-web</span> \
</span></span><span style=display:flex><span>  --publish published=8080,target=80 \
</span></span><span style=display:flex><span>  --replicas 10 \
</span></span><span style=display:flex><span>  nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#或是</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker service create \
</span></span><span style=display:flex><span>  --name <span style=color:#a2f>my-web</span> \
</span></span><span style=display:flex><span>  -p 8080<span>:</span>80 \
</span></span><span style=display:flex><span>  --replicas 3 \
</span></span><span style=display:flex><span>  nginx
</span></span></code></pre></div><p>UDP 與 TCP</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>docker service create --name <span style=color:#a2f>dns-cache</span> \
</span></span><span style=display:flex><span> --publish published=53,target=53 \
</span></span><span style=display:flex><span> --publish published=53,target=53,protocol=udp \
</span></span><span style=display:flex><span> <span style=color:#a2f>dns-cache</span>
</span></span></code></pre></div><h2 id=docker-registry>docker registry</h2><p>docker 存放 containner image 的地方稱為 registry
docker hub 即為一個 registry</p><p>企業內部可能會認為自建一個 registry 比較安全</p><p>這時可使用官方的 docker registry server</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#080;font-style:italic># 建立</span>
</span></span><span style=display:flex><span>docker service create \
</span></span><span style=display:flex><span>  --name registry \
</span></span><span style=display:flex><span>  -p 5000<span>:</span>5000  \
</span></span><span style=display:flex><span>  registry
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Pull some image from the hub</span>
</span></span><span style=display:flex><span>docker pull nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># add tag to image</span>
</span></span><span style=display:flex><span>docker image tag nginx localhost<span>:</span>5000/nginx_v1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Push it</span>
</span></span><span style=display:flex><span>docker push localhost<span>:</span>5000/nginx_v1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 查詢 registry server image</span>
</span></span><span style=display:flex><span><span style=color:#a2f>curl </span>-X GET http<span>:</span>//localhost<span>:</span>5000/v2/_catalog
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/docker rel=tag title=docker>#docker#</a></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bu-jue-ming-shi.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目錄</li><li class=sidebar-nav-overview data-target=site-overview>網站導覽</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.png alt=Owan><p class=site-author-name itemprop=name>Owan</p><p class="site-description motion-element" itemprop=description>愛貓如癡</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>131</span>
<span class=site-state-item-name>日誌</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>29</span>
<span class=site-state-item-name>分類</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>37</span>
<span class=site-state-item-name>標籤</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/lovesharepc/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#優點>優點</a></li><li><a href=#節點>節點</a><ul><li><a href=#新增>新增</a></li><li><a href=#節點-維護>節點 維護</a></li><li><a href=#節點-移除>節點 移除</a></li></ul></li><li><a href=#docker-swarm-shared-storage>docker swarm shared storage</a></li><li><a href=#service-control>service control</a></li><li><a href=#docker-registry>docker registry</a></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>補覺鳴詩</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.96.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var t=$(".header-inner").height()+10,n,s,e,o;$("#sidebar").css({'margin-top':t}).show(),n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height(),o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script>(function(){var e=document.createElement("script"),t,n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>