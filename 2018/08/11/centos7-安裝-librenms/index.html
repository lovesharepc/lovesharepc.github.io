<!doctype html><html lang=zh-tw dir=content/zh-tw>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> CentOS7 安裝 librenms - 補覺鳴詩 </title>
<meta name=keywords content="infra">
<meta name=author content="Owan">
<meta property="og:title" content="CentOS7 安裝 librenms">
<meta property="og:site_name" content="補覺鳴詩">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="CentOS7 安裝 librenms - 補覺鳴詩">
<meta name=description content="IT 職涯各種紀錄。">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-tw href=#>正體中文</a>
</div>
<div class=custom-logo-site-title>
<a href=/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>補覺鳴詩</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle>學海無涯</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>首頁
</a>
</li>
<li class=menu-item>
<a href=/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>archive
</a>
</li>
<li class=menu-item>
<a href=/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>關於我
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> 搜尋</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder=搜索關鍵字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">
<a class=post-title-link href=https://lovesharepc.github.io/2018/08/11/centos7-%E5%AE%89%E8%A3%9D-librenms/ itemprop=url>
CentOS7 安裝 librenms
</a>
</h1>
<div class=post-meta>
<span class=post-time>
<i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>時間：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2018-08-11">
2018-08-11
</time>
</span>
<span class=post-category>
&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分類：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/categories/centos-7 itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>Centos 7</span>
</a>
&nbsp;
</span>
</span>
<span>
|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字數：</span>
<span class=leancloud-world-count>1115 字</span>
</span>
<span>
|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>閱讀：</span>
<span class=leancloud-view-count>3分鐘</span>
</span>
<span id=/2018/08/11/centos7-%E5%AE%89%E8%A3%9D-librenms/ class=leancloud_visitors data-flag-title="CentOS7 安裝 librenms">
|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>閱讀次數：</span>
<span class=leancloud-visitors-count></span>
</span>
</div>
</header>
<div class=post-body itemprop=articleBody>
<p>其實 librenms 官方 doc 已經寫得很詳細了<br>
照做只有幾個點要注意而已</p>
<p>官方手冊<br>
<a href=https://docs.librenms.org/#Installation/Installation-CentOS-7-Apache/>https://docs.librenms.org/#Installation/Installation-CentOS-7-Apache/</a></p>
<p>在 Install Required Packages<br>
建議順便裝 3 個套件<br>
wget nano python-ipaddress</p>
<ol>
<li></li>
<li></li>
<li></li>
</ol>
<p>該動作為每天凌晨執行 scan 動作<br>
建議不要太常執行，因為掃一次的時間會蠻長的</p>
<p>接著設定 syslog<br>
<a href=https://docs.librenms.org/#Extensions/Syslog/%23syslog-server-installation>https://docs.librenms.org/#Extensions/Syslog/#syslog-server-installation</a><br>
<span style=background-color:#fff;color:#333;font-family:monospace,serif;font-size:12px;white-space:pre>tcp(port(</span><span style=background-color:#fff;box-sizing:border-box;color:teal;font-family:monospace,serif;font-size:12px;white-space:pre>514</span><span style=background-color:#fff;color:#333;font-family:monospace,serif;font-size:12px;white-space:pre>) 會失敗 建議先不開</span></p>
<p>記得開防火牆，librenms 就能收到 log 了<br>
firewall-cmd –permanent –add-port=514/udp<br>
firewall-cmd –permanent –add-port=514/tcp</p>
<div>
</div>
<div>
</div>
<pre>安裝工具 
yum install -y nano wget unzip</pre>
<p>指定 php 版本<br>
yum install -y epel-release<br>
yum install -y <a href=http://rpms.remirepo.net/enterprise/remi-release-7.rpm>http://rpms.remirepo.net/enterprise/remi-release-7.rpm</a><br>
yum install -y yum-utils<br>
yum-config-manager –disable remi-php54<br>
yum-config-manager –enable remi-php72</p>
<p>新版 mariadb<br>
curl -sS <a href=https://downloads.mariadb.com/MariaDB/mariadb>https://downloads.mariadb.com/MariaDB/mariadb</a>_repo_setup | sudo bash</p>
<p>新版 apache<br>
cd /etc/yum.repos.d && wget <a href=https://repo.codeit.guru/codeit.el>https://repo.codeit.guru/codeit.el</a>`rpm -q –qf “%{VERSION}” $(rpm -q –whatprovides redhat-release)`.repo</p>
<p>安裝套件<br>
yum install -y git cronie fping jwhois ImageMagick mtr MySQL-python MySQL-python net-snmp net-snmp-utils nmap python-memcached rrdtool policycoreutils-python httpd mariadb mariadb-server<br>
yum install -y php httpd mod_php php-cli php-common php-curl php-gd php-mbstring php-process php-snmp php-xml php-zip php-memcached php-mysqlnd</p>
<p>useradd librenms -d /opt/librenms -M -r<br>
usermod -a -G librenms apache</p>
<p>cd /opt<br>
git clone <a href=https://github.com/librenms/librenms.git>https://github.com/librenms/librenms.git</a></p>
<p>chown -R librenms:librenms /opt/librenms<br>
chmod 770 /opt/librenms<br>
setfacl -d -m g::rwx /opt/librenms/rrd /opt/librenms/logs /opt/librenms/bootstrap/cache/ /opt/librenms/storage/ /opt/librenms/cache<br>
setfacl -R -m g::rwx /opt/librenms/rrd /opt/librenms/logs /opt/librenms/bootstrap/cache/ /opt/librenms/storage/ /opt/librenms/cache</p>
<p>su – librenms<br>
./scripts/composer_wrapper.php install –no-dev<br>
exit</p>
<p>systemctl start mariadb<br>
systemctl start httpd<br>
systemctl enable mariadb<br>
systemctl enable httpd<br>
systemctl disable firewalld</p>
<p>mysql -u root -p<br>
CREATE DATABASE librenmsDB CHARACTER SET utf8 COLLATE utf8_unicode_ci;<br>
CREATE USER ‘librenmsUSER’@’localhost’ IDENTIFIED BY ‘librenmsPW’;<br>
GRANT ALL PRIVILEGES ON librenmsDB.* TO ‘librenmsUSER’@’localhost’;<br>
FLUSH PRIVILEGES;<br>
exit</p>
<p>nano /etc/my.cnf.d/server.cnf<br>
Within the [mysqld] section please add:<br>
default-time-zone = ‘+8:00’<br>
innodb_file_per_table=1<br>
lower_case_table_names=0</p>
<p>systemctl restart mariadb</p>
<p>Configure Apache<br>
Create the librenms.conf:</p>
<p>nano /etc/httpd/conf.d/librenms.conf<br>
Add the following config, edit ServerName as required:</p>
<p>DocumentRoot /opt/librenms/html/<br>
ServerName librenms.example.com</p>
<p>AllowEncodedSlashes NoDecode<br>
&lt;directory “/opt/librenms/html/”><br>
Require all granted<br>
AllowOverride All<br>
Options FollowSymLinks MultiViews</p>
<p>sed -e ‘s/memory_limit = 128M/memory_limit = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/max_execution_time = 30/max_execution_time = 180/’ -i /etc/php.ini<br>
sed -e ‘s/upload_max_filesize = 2M/upload_max_filesize = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/post_max_size = 8M/post_max_size = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/^;date.timezone =/date.timezone =”Asia/Taipei”/’ -i /etc/php.ini<br>
systemctl restart httpd</p>
<p>nano http_fping.tt</p>
<p>module http_fping 1.0;</p>
<p>require {<br>
type httpd_t;<br>
class capability net_raw;<br>
class rawip_socket { getopt create setopt write read };<br>
}</p>
<p>#============= httpd_t ==============<br>
allow httpd_t self:capability net_raw;<br>
allow httpd_t self:rawip_socket { getopt create setopt write read };</p>
<p>checkmodule -M -m -o http_fping.mod http_fping.tt<br>
semodule_package -o http_fping.pp -m http_fping.mod<br>
semodule -i http_fping.pp</p>
<p>Copy the example snmpd.conf from the LibreNMS install.</p>
<p>cp /opt/librenms/snmpd.conf.example /etc/snmp/snmpd.conf</p>
<p>vi /etc/snmp/snmpd.conf<br>
Edit the text which says RANDOMSTRINGGOESHERE and set your own community string.</p>
<p>curl -o /usr/bin/distro <a href=https://raw.githubusercontent.com/librenms/librenms-agent/master/snmp/distro>https://raw.githubusercontent.com/librenms/librenms-agent/master/snmp/distro</a><br>
chmod +x /usr/bin/distro<br>
systemctl enable snmpd<br>
systemctl restart snmpd<br>
Cron job</p>
<p>cp /opt/librenms/librenms.nonroot.cron /etc/cron.d/librenms<br>
NOTE: Keep in mind that cron, by default, only uses a very limited set of environment variables. You may need to configure proxy variables for the cron invocation. Alternatively adding the proxy settings in config.php is possible too. The config.php file will be created in the upcoming steps. Review the following URL after you finished librenms install steps: <a href=https://docs.librenms.org/Support/Configuration/#proxy-support>https://docs.librenms.org/Support/Configuration/#proxy-support</a></p>
<p>Copy logrotate config<br>
LibreNMS keeps logs in /opt/librenms/logs. Over time these can become large and be rotated out. To rotate out the old logs you can use the provided logrotate config file:</p>
<p>cp /opt/librenms/misc/librenms.logrotate /etc/logrotate.d/librenms<br>
Web installer<br>
Now head to the web installer and follow the on-screen instructions.</p>
<p><a href=http://librenms.example.com/install.php>http://librenms.example.com/install.php</a></p>
<p>sed -e ‘s/memory_limit = 128M/memory_limit = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/max_execution_time = 30/max_execution_time = 180/’ -i /etc/php.ini<br>
sed -e ‘s/upload_max_filesize = 2M/upload_max_filesize = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/post_max_size = 8M/post_max_size = 1024M/’ -i /etc/php.ini<br>
sed -e ‘s/^;date.timezone =/date.timezone =”Asia/Taipei”/’ -i /etc/php.ini<br>
systemctl restart httpd</p>
<p>sudo chown -R librenms:librenms /opt/librenms<br>
sudo setfacl -d -m g::rwx /opt/librenms/rrd /opt/librenms/logs /opt/librenms/bootstrap/cache/ /opt/librenms/storage/<br>
sudo chmod -R ug=rwX /opt/librenms/rrd /opt/librenms/logs /opt/librenms/bootstrap/cache/ /opt/librenms/storage/</p>
<p>timedatectl set-timezone Asia/Taipei</p>
<pre></pre>
</div>
<footer class=post-footer>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//bu-jue-ming-shi.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<section class="site-overview sidebar-panel sidebar-panel-active">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=Owan>
<p class=site-author-name itemprop=name>Owan</p>
<p class="site-description motion-element" itemprop=description>
愛貓如癡
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/post/>
<span class=site-state-item-count>115</span>
<span class=site-state-item-name>日誌</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>12</span>
<span class=site-state-item-name>分類</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>20</span>
<span class=site-state-item-name>標籤</span>
</a>
</div>
</nav>
<div class="links-of-author motion-element">
<span class=links-of-author-item>
<a href=https://github.com/lovesharepc/ target=_blank title=GitHub>
<i class="fa fa-fw fa-github"></i>
GitHub
</a>
</span>
</div>
<div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline">
<div class=tagcloud-of-blogroll-title>
<i class="fa fa-fw fa-tags"></i>
標簽雲
</div>
<ul class=tagcloud-of-blogroll-list>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/windows>Windows</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/centos-7>Centos 7</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/markdown>Markdown</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/anti-virus>Anti virus</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/bareos>Bareos</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/chrony>Chrony</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/css>Css</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/emoji>Emoji</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/html>HTML</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/ntop>Ntop</a>
</li>
</ul>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>補覺鳴詩</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.92.2</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv>
<i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span>
</span>
<span class=separator-line>/</span>
<span class=site-pv>
<i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span>
</span>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:!0,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 歡迎留下您的寶貴建議，請填寫您的昵稱和郵箱便於後續交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-tw"})}):$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建議使用Chrome瀏覽器。')})</script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>